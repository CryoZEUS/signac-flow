{# The following variables are available to all scripts. #}
{% if overview or detailed %}
{% set field_operation = ('%%-%ss %%3s' | format(column_width_operation)) %}
{% set field_operation_title = ('%%-%ss  ' | format(column_width_operation+4)) %}
{% set ns = namespace(dash='', field_parameters='') %}
{% endif %}
{% if overview %}
{% set field_progress_bar = ((table_string + '%%-%ss  ' + table_string + '%%-%ss' + table_string) | format(column_width_label, column_width_bar)) %}
{% endif %}
{% if detailed %}
{% set field_job_id = ('%%-%ss  ' | format(column_width_id)) %}
{% set field_label = ('%%-%ss' | format(column_width_total_label)) %}
{% if parameters %}
{% for para in parameters %}
{% set ns.dash = ns.dash + ('%s  ' | format('-' * column_width_parameters[loop.index0])) + table_string %}
{% set ns.field_parameters = ns.field_parameters + ('%%-%ss  ' | format(column_width_parameters[loop.index0])) + table_string %}
{% endfor %}
{% set para_head = ns.field_parameters | format(*parameters) %}
{% endif %}
{% set detail_field_head = table_string + field_job_id + table_string + field_operation_title + table_string + '%s' + field_label + table_string %}
{% endif %}

{% block overview %}
{% if overview %}
{{ '# Overview: ' }}
{{ 'Total # of jobs: %s ' | format(jobs | length) }}

{% block progress %}
| label | ratio |
| ----- | ----- |
{% for label in progress_sorted %}
| {{ label[0] }} | {{label[1]|draw_progressbar(jobs | length, '\\') }} |
{% endfor %}
{% endblock %}

{% block operation_summary %}
| operation | number of eligible jobs |
| --------- | ----------------------- |
{% for op, n_jobs in op_counter %}
| {{ op }} | {{ n_jobs }} |
{% endfor %}
{% endblock %}

{% endif %}
{% endblock%}

{% block detailed %}
{% if detailed %}
{{ '# Detailed View: ' }}
| job_id | operation | labels |
| ------ | --------- | ------ |
{% for job in jobs %}
{% for operation in job['operations'] %}
| {{ job['job_id'] }} | {{ operation }} | {{ job['labels'] | join(',') }} |
{% endfor %}
{% endfor %}
{{ status_legend }}
{% endif %}
{% endblock %}
